name: Publish to Testflight

on:
    push:
        branches:
            - master

jobs:
    publish:
        name: Publish to Testflight
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - uses: actions/setup-node@v1
              with:
                  node-version: 14.x
            - name: Setup expo
              uses: expo/expo-github-action@v5
              with:
                  expo-version: 4.x
                  expo-username: ${{ secrets.EXPO_CLI_USERNAME }}
                  expo-password: ${{ secrets.EXPO_CLI_PASSWORD }}
                  expo-cache: true
            - name: Cache
              uses: actions/cache@v2
              with:
                  path: "**/node_modules"
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ hashFiles('**/yarn.lock') }}
                  restore-keys: |
                      ${{ runner.os }}-build-${{ env.cache-name }}-
                      ${{ runner.os }}-build-
                      ${{ runner.os }}-
            - name: Install deps
              run: yarn install
            # - name: Test
              # run: yarn test:ci
            # - name: Lint
              # run: yarn lint
            - name: Build a Testflight app
              run: yarn build:ios --release-channel=testflight
